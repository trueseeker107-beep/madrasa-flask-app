{% extends "base.html" %}
{% block title %}Results{% endblock %}

{% block content %}
<h1 class="mb-3">Results</h1>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="flash-wrap">
      {% for category, msg in messages %}
        <div class="flash {{ category }}">{{ msg }}</div>
      {% endfor %}
    </div>
  {% endif %}
{% endwith %}

<section class="card">
  <h2 class="card-title">Recent Entries</h2>
  {% if recent and recent|length %}
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Programme</th>
          <th>Student ID</th>
          <th>Student Name</th>
          <th>Judge</th>
          <th>Score</th>
          <th>Remarks</th>
          <th>Created</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for row in recent %}
        {# row = (id, programme_code, student_id, student_name, judge_name, score, remarks, created_at) #}
        <tr>
          <td>{{ row[0] }}</td>
          <td>{{ row[1] }}</td>
          <td>{{ row[2] }}</td>
          <td>{{ row[3] }}</td>
          <td>{{ row[4] }}</td>
          <td>{{ "%.2f"|format(row[5]) }}</td>
          <td>{{ row[6] }}</td>
          <td><small>{{ row[7] }}</small></td>
          <td>
            <form action="{{ url_for('delete_score', score_id=row[0]) }}" method="post" onsubmit="return confirm('Delete this score?');">
              <button type="submit" class="btn btn-danger btn-sm">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p>No entries yet.</p>
  {% endif %}
</section>

<section class="card mt-4">
  <h2 class="card-title">Totals by Student</h2>
  {% if totals and totals|length %}
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>#</th>
          <th>Student ID</th>
          <th>Student Name</th>
          <th>Total Score</th>
        </tr>
      </thead>
      <tbody>
        {% for row in totals %}
        {# row = (student_id, student_name, total) #}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ row[0] }}</td>
          <td>{{ row[1] }}</td>
          <td>{{ "%.2f"|format(row[2]) }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
    <p>No totals to display yet.</p>
  {% endif %}
</section>

<style>
  .flash-wrap { margin: 10px 0; }
  .flash { padding: .6rem .8rem; border-radius: 8px; margin-bottom: .5rem; }
  .flash.ok { background: #e6ffed; color: #03543f; border: 1px solid #84e1bc; }
  .flash.err { background: #ffe6e6; color: #7a0916; border: 1px solid #ff9aa2; }
  .card { background: #fff; border-radius: 12px; padding: 1rem; box-shadow: 0 2px 10px rgba(0,0,0,.06); }
  .card-title { margin: 0 0 .75rem 0; font-size: 1.1rem; }
  .table-wrap { overflow-x: auto; }
  .table { width: 100%; border-collapse: collapse; }
  .table th, .table td { padding: .55rem .6rem; border-bottom: 1px solid #eee; text-align: left; }
  .table thead th { background: #f7f7f9; font-weight: 600; }
  .btn { border: 0; border-radius: 8px; padding: .4rem .6rem; cursor: pointer; }
  .btn-sm { font-size: .85rem; }
  .btn-danger { background: #e02424; color: #fff; }
  .btn-danger:hover { filter: brightness(.95); }
  .mt-4 { margin-top: 1.25rem; }
  small { color: #666; }
</style>
{% endblock %}